[tox]
skipsdist = True
envlist = upgrade

[vars]
releases_test_path = {toxinidir}/tests-bundle/

[testenv]
setenv =
    PYTHONPATH={toxinidir}:{toxinidir}/src
    PYTHONBREAKPOINT=ipdb.set_trace

[testenv:lint]
deps =
  black
  mdformat-gfm
commands =
  black --check {toxinidir}/scripts/ {toxinidir}/tests/
  mdformat --check --wrap=100 {toxinidir}/README.md

[testenv:fmt]
deps =
  black
  mdformat-gfm
commands =
  black {toxinidir}/scripts/ {toxinidir}/tests/ {[vars]releases_test_path}
  mdformat --wrap=100 {toxinidir}/README.md

[testenv:tests]
setenv =
    # Needed for juju cli to work correctly
    HOME={env:HOME}
    # Needed to pass creds through environment variables
passenv =
    KUBEFLOW_AUTH_USERNAME
    KUBEFLOW_AUTH_PASSWORD
deps =
    -rrequirements.txt
    -rtest-requirements.txt
    pytest-operator
commands = pytest -v --tb native --show-capture=no {posargs} {toxinidir}/tests/

[testenv:test_bundle_1.6]
commands = pytest -vs --tb native {[vars]releases_test_path}1.6 -m deploy --model kubeflow --channel 1.6/stable {posargs}
deps =
  -r {[vars]releases_test_path}/1.6/requirements.txt
description = Test bundles

[testenv:test_bundle_1.7]
commands =
    pytest -vs --tb native {[vars]releases_test_path}1.7 -m deploy --model kubeflow --channel 1.7/stable {posargs}

deps =
  -r {[vars]releases_test_path}/1.7/requirements.txt
description = Test bundles


[testenv:test_selenium_1.7]
commands =
    pytest -vs --tb native {[vars]releases_test_path}1.7 -m selenium --model kubeflow --channel 1.7/stable {posargs}

deps =
  -r {[vars]releases_test_path}/1.7/requirements.txt
description = Test bundles